import{J as N,c as R,K as A,o as D,V as U,W as j}from"./@vue.32bd4199.js";var W=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function O(e,o){return o={exports:{}},e(o,o.exports),o.exports}var I=O(function(e,o){(function(t,n){e.exports=n()})(W,function(){return function t(n,r,l){var a=window,p="application/octet-stream",f=l||p,s=n,h=!r&&!l&&s,d=document.createElement("a"),v=function(i){return String(i)},c=a.Blob||a.MozBlob||a.WebKitBlob||v,y=r||"download",u,S;if(c=c.call?c.bind(a):Blob,String(this)==="true"&&(s=[s,f],f=s[0],s=s[1]),h&&h.length<2048&&(y=h.split("/").pop().split("?")[0],d.href=h,d.href.indexOf(h)!==-1)){var b=new XMLHttpRequest;return b.open("GET",h,!0),b.responseType="blob",b.onload=function(i){t(i.target.response,y,p)},setTimeout(function(){b.send()},0),b}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(s))if(s.length>1024*1024*1.999&&c!==v)s=T(s),f=s.type||p;else return navigator.msSaveBlob?navigator.msSaveBlob(T(s),y):w(s);else if(/([\x80-\xff])/.test(s)){var g=0,C=new Uint8Array(s.length),$=C.length;for(g;g<$;++g)C[g]=s.charCodeAt(g);s=new c([C],{type:f})}u=s instanceof c?s:new c([s],{type:f});function T(i){var m=i.split(/[:;,]/),x=m[1],L=m[2]=="base64"?atob:decodeURIComponent,V=L(m.pop()),E=V.length,k=0,F=new Uint8Array(E);for(k;k<E;++k)F[k]=V.charCodeAt(k);return new c([F],{type:x})}function w(i,m){if("download"in d)return d.href=i,d.setAttribute("download",y),d.className="download-js-link",d.innerHTML="downloading...",d.style.display="none",document.body.appendChild(d),setTimeout(function(){d.click(),document.body.removeChild(d),m===!0&&setTimeout(function(){a.URL.revokeObjectURL(d.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(i)&&(i="data:"+i.replace(/^data:([\w\/\-\+]+)/,p)),window.open(i)||confirm(`Displaying New Document

Use Save As... to download, then click back to return to this page.`)&&(location.href=i),!0;var x=document.createElement("iframe");document.body.appendChild(x),!m&&/^data:/.test(i)&&(i="data:"+i.replace(/^data:([\w\/\-\+]+)/,p)),x.src=i,setTimeout(function(){document.body.removeChild(x)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(u,y);if(a.URL)w(a.URL.createObjectURL(u),!0);else{if(typeof u=="string"||u.constructor===v)try{return w("data:"+f+";base64,"+a.btoa(u))}catch{return w("data:"+f+","+encodeURIComponent(u))}S=new FileReader,S.onload=function(i){w(this.result)},S.readAsDataURL(u)}return!0}})}),B=N({props:{type:{type:String,default:"xls"},data:{type:Array,required:!1,default:null},fields:{type:Object,default:()=>null},exportFields:{type:Object,default:()=>null},defaultValue:{type:String,required:!1,default:""},header:{default:null},footer:{default:null},name:{type:String,default:"data.xls"},fetch:{type:Function},meta:{type:Array,default:()=>[]},worksheet:{type:String,default:"Sheet1"},beforeGenerate:{type:Function},beforeFinish:{type:Function},escapeCsv:{type:Boolean,default:!0},stringifyLongNum:{type:Boolean,default:!1}},computed:{idName(){var e=new Date().getTime();return"export_"+e},downloadFields(){if(this.fields)return this.fields;if(this.exportFields)return this.exportFields}},methods:{async generate(){typeof this.beforeGenerate=="function"&&await this.beforeGenerate();let e=this.data;if((typeof this.fetch=="function"||!e)&&(e=await this.fetch()),!e||!e.length)return;let o=this.getProcessedJson(e,this.downloadFields);return this.type==="html"?this.export(this.jsonToXLS(o),this.name.replace(".xls",".html"),"text/html"):this.type==="csv"?this.export(this.jsonToCSV(o),this.name.replace(".xls",".csv"),"application/csv"):this.export(this.jsonToXLS(o),this.name,"application/vnd.ms-excel")},export:async function(e,o,t){let n=this.base64ToBlob(e,t);typeof this.beforeFinish=="function"&&await this.beforeFinish(),I(n,o,t)},jsonToXLS(e){let o='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta name=ProgId content=Excel.Sheet> <meta name=Generator content="Microsoft Excel 11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>${worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--><style>br {mso-data-placement: same-cell;}</style></head><body><table>${table}</table></body></html>',t="<thead>";const n=Object.keys(e[0]).length;let r=this;const l=this.header||this.$attrs.title;l&&(t+=this.parseExtraData(l,'<tr><th colspan="'+n+'">${data}</th></tr>')),t+="<tr>";for(let a in e[0])t+="<th>"+a+"</th>";return t+="</tr>",t+="</thead>",t+="<tbody>",e.map(function(a,p){t+="<tr>";for(let f in a)t+="<td>"+r.preprocessLongNum(r.valueReformattedForMultilines(a[f]))+"</td>";t+="</tr>"}),t+="</tbody>",this.footer!=null&&(t+="<tfoot>",t+=this.parseExtraData(this.footer,'<tr><td colspan="'+n+'">${data}</td></tr>'),t+="</tfoot>"),o.replace("${table}",t).replace("${worksheet}",this.worksheet)},jsonToCSV(e){let o=this;var t=[];const n=this.header||this.$attrs.title;n&&t.push(this.parseExtraData(n,"${data}\r\n"));for(let r in e[0])t.push(r),t.push(",");return t.pop(),t.push(`\r
`),e.map(function(r){for(let l in r){let a=r[l]+"";o.escapeCsv&&(a='="'+a+'"',a.match(/[,"\n]/)&&(a='"'+a.replace(/\"/g,'""')+'"')),t.push(a),t.push(",")}t.pop(),t.push(`\r
`)}),this.footer!=null&&t.push(this.parseExtraData(this.footer,"${data}\r\n")),t.join("")},getProcessedJson(e,o){let t=this.getKeys(e,o),n=[],r=this;return e.map(function(l,a){let p={};for(let f in t){let s=t[f];p[f]=r.getValue(s,l)}n.push(p)}),n},getKeys(e,o){if(o)return o;let t={};for(let n in e[0])t[n]=n;return t},parseExtraData(e,o){let t="";if(Array.isArray(e))for(var n=0;n<e.length;n++)e[n]&&(t+=o.replace("${data}",e[n]));else t+=o.replace("${data}",e);return t},getValue(e,o){const t=typeof e!="object"?e:e.field;let n=typeof t!="string"?[]:t.split("."),r=this.defaultValue;return t?n.length>1?r=this.getValueFromNestedItem(o,n):r=this.parseValue(o[t]):r=o,e.hasOwnProperty("callback")&&(r=this.getValueFromCallback(r,e.callback)),r},valueReformattedForMultilines(e){return typeof e=="string"?e.replace(/\n/gi,"<br/>"):e},preprocessLongNum(e){if(this.stringifyLongNum){if(String(e).startsWith("0x"))return e;if(!isNaN(e)&&e!=""&&(e>99999999999||e<1e-13))return'="'+e+'"'}return e},getValueFromNestedItem(e,o){let t=e;for(let n of o)t&&(t=t[n]);return this.parseValue(t)},getValueFromCallback(e,o){if(typeof o!="function")return this.defaultValue;const t=o(e);return this.parseValue(t)},parseValue(e){return e||e===0||typeof e=="boolean"?e:this.defaultValue},base64ToBlob(e,o){let t=window.btoa(window.unescape(encodeURIComponent(e))),n=atob(t),r=n.length,l=new Uint8ClampedArray(r);for(;r--;)l[r]=n.charCodeAt(r);return new Blob([l],{type:o})}}});const G=["id"];function M(e,o,t,n,r,l){return D(),R("div",{id:e.idName,onClick:o[0]||(o[0]=(...a)=>e.generate&&e.generate(...a))},[A(e.$slots,"default",{},()=>[U(" Download "+j(e.name),1)])],8,G)}B.render=M;B.__file="JsonExcel.vue";export{B as s};
